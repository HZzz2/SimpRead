> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [medium.com](https://medium.com/@fath3ad.22/passive-active-information-gathering-subdomain-enumeration-e5538c3d3ecc)

> 这篇文章旨在分享我在通过 Informati 工作时学到的一些信息......

在开始讨论任何类型的渗漏测试安全评估之前，我们需要对所涉及的目标有一个清晰的了解。我们需要接触到多个获取有关目标的信息，以便清楚地了解正在处理地表的情况。不管怎样正在评估目标的网络存在以及他们的整体基础设施，这是正确的。因此，必须在进行网络评估时，进行信息收集以收集信息，例如：

*   域和子域
*   知识产权范围
*   网络基础设施
*   潜在的虚拟主机

在这种情况下，信息传输过程中的类型：

*   **被动**：在不与目标发布直接信息的情况下使用。这意味着在不获取搜索引擎、证书、社交媒体信息发布甚至发布之类的东西来获取公开可用的信息。
*   **这个**阶段需要直接获取信息。因为通常所涉及的一些活动可能被认为是进行的活动，这个阶段的一些活动包括：扫描、DNS、、枚举目录暴力破解和Web应用程序爬取/爬虫。

注意事项是，它可能会发生在评估的任何阶段。我们掌握的关于目标的信息越多，我们就有关于有定制我们的测试，如果有一点可能取得成功并且可能为客户提供价值。

出于本文的目的，我将介绍进行被动和主动信息收集的不同方法，因为它与枚举子域有关。请注意，此处的示例目标 ( **tesla.com** ) 有一个开放的错误赏金计划，允许进行此活动。在进行这些测试时请小心，以确保所进行的活动是合法的。

DNS or Domain Name System can be thought of as the internet’s phone book. It’s a protocol by which domain names are converted from their human-readable names to IP addresses. This is so that when we want to go to **google.com**, we don’t have to memorize it by its IP address **142.250.176.78**. Each internet-connected device has a unique IP address that other machines/servers use to locate it. How these machines are able to be located can be understood by analyzing a URL of a website. Say we have [**www.tesla.com**](http://www.tesla.com/) as an example. DNS hostnames such as this one are set up in a type of hierarchy, starting from the root domain(.). This isn’t explicitly shown in the URL because it’s already implied, as everything starts from the root domain.

Starting from right to left, the first domains that are nested under the root domain are called [Top-Level Domains (TLDs)](https://en.wikipedia.org/wiki/Top-level_domain). Some examples of these domains include: **com**, **edu**, and **net**. The next level of nested domains are the second-level domains which are usually the domains we’re trying to get to. These domain names are registered with a domain name registrar which basically signs them up to be part of the internet phonebook. Any domain nested under these secondary domains are considered subdomains and are usually part of the organization. So our example: **com** is the top level domain which is typically used by commercial organizations, **tesla** is the main domain and organization we’re trying to reach and **www** is the subdomain for the main webpage of the organization. As mentioned before, the root domain is not mentioned in the URL but would be to the right of **com** (**com.**).

For more information on DNS please see [Domain Name System](https://en.wikipedia.org/wiki/Domain_Name_System)

Now that we have a general understanding of DNS, we can move the conversation now to enumerating subdomains. Since subdomains are set up by individual companies and may be used for different reasons within the organization, they may prove to be useful to uncover during a security assessment. Like **www**, there may be subdomains for other web pages that may not be as tightly managed, for internal portals only used by employees such as an intranet or any other reason that network administrators would want to keep hidden.

There are many ways to conduct passive subdomain enumeration. For that reason I’m only going to focus on a couple of examples. For passive subdomain enumeration, I’ll be retrieving information from the following sources:

*   Project Sonar
*   SSL/TLS Certificates
*   Sublist3r (tool)

Project Sonar
-------------

[Project Sonar](http://rapid7.com/research/project-sonar/) is a security research project by Rapid7 which conducts internet-wide surveys across various services and protocols to gather insight into worldwide vulnerability exposure. Because the information is made to be public to facilitate research, we can use the project to find subdomains. We can do this by visiting the API URL ([https://sonar.omnisint.io/subdomains/](https://sonar.omnisint.io/subdomains/)<domain>). In our example we’d use [**https://sonar.omnisint.io/subdomains/tesla.com**](https://sonar.omnisint.io/subdomains/tesla.com) however the output on the browser may be harder to read as the response is in JSON format.

![](https://miro.medium.com/max/1400/1*XueM3dVrpcI58KehAWqbxg.png)

JSON ouput from [**https://sonar.omnisint.io/subdomains/tesla.com**](https://sonar.omnisint.io/subdomains/tesla.com)

A cleaner option would be to use Curl from the command line as follows:

> curl -k -s [https://sonar.omnisint.io/subdomains/tesla.com](https://sonar.omnisint.io/subdomains/tesla.com) | jq -r ‘.[]’ | sort -u

![](https://miro.medium.com/max/1400/0*6D6_FoA9n_KQns8t)

Command line output for [https://sonar.omnisint.io/subdomains/tesla.com](https://sonar.omnisint.io/subdomains/tesla.com)

Project Sonar also allows us to retrieve other information besides subdomains. For more information please see the [Git page for the associated API](https://github.com/Cgboal/SonarSearch) or [Omnisint website](https://omnisint.io/).

SSL/TLS Certificates
--------------------

SSL/TLS certs provide another interesting way of extracting subdomains for a target organization. [Certificate Transparency](https://en.wikipedia.org/wiki/Certificate_Transparency) requires that every certificate issued by a Certificate Authority must be published to a publicly accessible log. This allows for efficient identification of mistakenly or maliciously issued certificates. A useful resource to accomplish enumeration in this case would be [https://crt.sh/](https://crt.sh/). Simply type in the organization to search and a long list of certification information will be presented with dates and subdomains associated with each.

![](https://miro.medium.com/max/1400/0*fHp1nF7hsRb5FjR2)

Tesla.com certificate search using crt.sh

As with the previous example, using Curl from the command line may assist in accomplishing a cleaner output.

> curl -k -s “[https://crt.sh/?q=tesla.com&output=json](https://crt.sh/?q=tesla.com&output=json)" | jq -r ‘.[] | “\(.name_value)\n\(.common_name)”’ | sort -u

![](https://miro.medium.com/max/1400/0*YXVC5ztERz6wzmKs)

Command Line output from crt.sh curl command

Sublist3r
---------

There are plenty of tools that automate the passive enumeration of subdomains but one of my favorites is [Sublist3r](https://github.com/aboul3la/Sublist3r). It can be cloned from Github or installed using a package manager (if using Linux). Sublist3r enumerates subdomains using many search engines such as Google, Yahoo, Bing, Baidu and Ask. Sublist3r also enumerates subdomains using Netcraft, Virustotal, ThreatCrowd, DNSdumpster and ReverseDNS. It’s an ideal tool that takes the hassle out of doing manual searches. One thing to keep in mind that a lot of requests are being sent to these search engines so you may run into a situation where the requests are being blocked by CAPTCHAs.

![](https://miro.medium.com/max/1094/0*7Qx6JtOIRQLxj4kb)

Sublist3r output

Enabling verbosity (-v option) will display where the results were captured from. The example shows which subdomains were found using [ThreatCrowd](https://www.threatcrowd.org/).

![](https://miro.medium.com/max/1114/0*s8R62q9BBJsMNLIr)

Sublist3r verbose output

For active subdomain enumeration, we’ll be probing the target organization or 3rd party DNS servers previously identified. Remember this kind of enumeration can be noisy and can lead to detection of recon activities so take care and make sure assessments are done responsibly and with permission. For this section, we’ll be looking at DNS zone transfers and a command line tool called GoBuster.

Zone Transfer
-------------

When an organization sets up DNS, chances are there are more than one DNS server. This is so that there is redundancy and backup of information in the case that one of the primary DNS servers goes down. The replication or synchronization of the DNS information is done via zone transfers. The caveat is that zone transfers SHOULD ONLY be allowed by specified secondary DNS servers within the organization environment. Although rare, there may be times where DNS servers are misconfigured in that they allow ANYBODY to conduct zone transfers. If that is the case, anyone is able to retrieve ALL subdomains plus additional domain information present within an organization. Knowing that, it’s worth testing to see if this functionality is allowed.

Zone transfers can be done using command line tools such as Nslookup or Dig but we can also use online services such as [https://hackertarget.com/zone-transfer/](https://hackertarget.com/zone-transfer/) to expedite assessment. As we can see from the example below Tesla doesn’t allow zone transfers.

![](https://miro.medium.com/max/1180/0*FOWdnyTtmmJnASJ4)

Failed Zone Transfer output for Tesla.com

As mentioned, manual zone transfers can be done using command line utilities. In our example we’ll use Nslookup to understand how we’d do this manually.

1.  Identify the Name servers

> nslookup -type=NS tesla.com

Name servers are the servers that respond to DNS requests and deliver the appropriate information. In the command above, we’re specifying that we want a list of nameservers (**-type=NS**) for the tesla.com domain. Nslookup responded with the name servers as well as their associated IP Address.With these name servers, we can try performing a zone transfer on each one to see if any are misconfigured.

Note: if you used the online service from the previous example, you can see that it automatically tried to conduct a zone transfer each of the discovered named servers.

![](https://miro.medium.com/max/900/0*UVoBRkEfYFo-Pl7U)

NSLookup Output for tesla.com nameservers

2. Testing for ANY and AXFR Zone Transfer

> nslookup -type=any -query=AXFR tesla.com a1–12.akam.net

The command above is telling Nslookup that we want to retrieve **any** information we can using a Authoritative Transfer (**AXFR**) for **tesla.com** from name server **a1–12.akam.net.** Although the transfer failed, it’s still useful to know how a zone transfer is done.

Note: if ever a zone transfer is successful, there’s no need to continue the subdomain enumeration process as a successful zone transfer would result in having ALL domain information for the target.

![](https://miro.medium.com/max/1282/0*wbHP2XTIrDg34E4R)

Failed Zone Transfer for tesla.com using nslookup

**GoBuster**
------------

[Gobuster](https://github.com/OJ/gobuster) is a tool that can do many things but one of which is to perform subdomain enumeration. It does so by making many DNS requests, using a list of subdomains to guess, in hopes of finding valid subdomains. Essentially, the success of this approach depends on the list we’re using. Note: the longer the list, the noisier this will be as it will try each and every item in the list.

Ideally, evaluating the patterns and naming conventions of subdomains we’ve discovered during the passive phase would help us curate pretty effective lists but we could also use lists that others have already curated online. There are plenty of wordlists online that we can use for this, which can be found at the [Seclists Github repository](https://github.com/danielmiessler/SecLists).

For demonstration purposes, we’ve made a short list of subdomains to try against and ran the following command:

> **gobuster dns -d tesla.com -w simple-subdomain-list.txt**

This tells gobuster to run a DNS search on the tesla.com domain using the specified wordlist (**-w**) we gave.

![](https://miro.medium.com/max/1114/0*O30bR8kdXIpJr_Jq)

Gobuster output for discovered subdomains for tesla.com

GoBuster is useful because it’s quick and customizable in terms of the threads to use and the scanning options. Please see the Github page for more information on how to use it as I’m sure it will be very helpful.

我希望这篇文章被证明是收集子域信息的有用资源。这只是我在通过[HackTheBox Academy 的信息收集模块时](https://academy.hackthebox.com/course/preview/information-gathering---web-edition)学到的一些信息，希望它可以帮助下一个希望进入漏洞赏金或一般安全领域的人。请随时就所提供的信息以及任何提示或其他有用资源留下反馈。

谢谢！